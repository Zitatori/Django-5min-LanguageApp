{% extends "base.html" %}
{% block content %}
  <div class="card">
    <div class="card-header">
      <div>
        <h2 class="card-title">マッチング結果</h2>
        <p class="card-subtitle">
          5分レッスンの準備ができました。
        </p>
      </div>
      {% if request_obj.status == "matched" %}
        <span class="badge badge-green">マッチ済み</span>
      {% elif request_obj.status == "waiting" %}
        <span class="badge badge-gray">マッチング中</span>
      {% else %}
        <span class="badge badge-gray">キャンセル</span>
      {% endif %}
    </div>

    <p class="card-subtitle">
      希望言語: {{ request_obj.language.name }}
    </p>

    {% if match %}
      <div class="mt-16">
        <p><strong>講師:</strong> {{ match.tutor.user.username }}</p>
      </div>

      <div class="mt-16">
        <button class="btn" onclick="window.location.href='{% url 'lesson_room' match.id %}'">
          レッスンルームに入る
        </button>
        <button class="btn btn-outline" onclick="window.location.href='{% url 'home' %}'">
          ホームに戻る
        </button>
      </div>

    {% elif request_obj.status == "waiting" %}
      <!-- ここは今の「スピナー＋マッチング中」のままでOK -->
      <div class="spinner-wrapper">
        <div class="spinner"></div>
        <p>講師をマッチング中です…</p>
        <p class="text-muted">オンライン中の講師が見つかり次第、この画面が自動で更新されます。</p>
      </div>
      <div class="center mt-16">
        <button class="btn btn-outline" onclick="window.location.href='{% url 'home' %}'">
          キャンセルしてホームに戻る
        </button>
      </div>
      <script>
        setTimeout(function () {
          window.location.reload();
        }, 2000);
      </script>
    {% else %}
      <div class="mt-16">
        <p>このリクエストは有効ではありません。</p>
      </div>
      <div class="mt-16">
        <button class="btn btn-outline" onclick="window.location.href='{% url 'home' %}'">
          ホームに戻る
        </button>
      </div>
    {% endif %}
  </div>
{% endblock %}
