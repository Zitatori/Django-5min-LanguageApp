{% extends "base.html" %}
{% block content %}
  <div class="card">
    <div class="card-header">
      <div>
        <h2 class="card-title">Matching Result</h2>
        <p class="card-subtitle">
          Your 5-minute lesson is ready.
        </p>
      </div>
      {% if request_obj.status == "matched" %}
        <span class="badge badge-green">Matched</span>
      {% elif request_obj.status == "waiting" %}
        <span class="badge badge-gray">Matching</span>
      {% else %}
        <span class="badge badge-gray">Canceled</span>
      {% endif %}
    </div>

    <p class="card-subtitle">
      Selected language: {{ request_obj.language.name }}
    </p>

    {% if match %}
      <div class="mt-16">
        <p><strong>Tutor:</strong> {{ match.tutor.user.username }}</p>
      </div>

      <div class="mt-16">
        <button class="btn" onclick="window.location.href='{% url 'lesson_room' match.id %}'">
          Enter Lesson Room
        </button>
        <button class="btn btn-outline" onclick="window.location.href='{% url 'home' %}'">
          Back to Home
        </button>
      </div>

    {% elif request_obj.status == "waiting" %}
      <!-- Spinner + matching in progress -->
      <div class="spinner-wrapper">
        <div class="spinner"></div>
        <p>Matching you with a tutorâ€¦</p>
        <p class="text-muted">
          This page will automatically update as soon as an available tutor is found.
        </p>
      </div>
      <div class="center mt-16">
        <button class="btn btn-outline" onclick="window.location.href='{% url 'home' %}'">
          Cancel and return to Home
        </button>
      </div>
      <script>
        setTimeout(function () {
          window.location.reload();
        }, 2000);
      </script>
    {% else %}
      <div class="mt-16">
        <p>This request is no longer valid.</p>
      </div>
      <div class="mt-16">
        <button class="btn btn-outline" onclick="window.location.href='{% url 'home' %}'">
          Back to Home
        </button>
      </div>
    {% endif %}
  </div>
{% endblock %}
