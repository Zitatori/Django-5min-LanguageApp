# QuickLesson – 5分オンラインレッスン（開発中）

**ステータス：** まだゴリゴリ開発中。本番運用レベルではない。

QuickLesson は、  
**「生徒 ↔ 承認済み講師の 5分オンラインレッスン」** に特化した Django プロジェクト。

目的ははっきりしていて：

- 出会い目的・エロ目的・暇つぶしチャットを潰す  
- 長時間だらだら話すのを防ぐ（**5分縛り**）  
- **管理者がちゃんと監視・介入できる仕組み**を持つ

という、安全寄りのミニマルな会話プラットフォームを作ること。

---

## このプロジェクトでやりたいこと

ざっくりいうと：

- マッチングは **「生徒 ↔ 講師」だけ**（ユーザー同士のランダム通話はやらない）
- レッスン時間は **1回5分まで（強制終了）**
- 講師は **審査・承認制**
- 将来的に：
  - ブラウザ内で動くビデオ通話（WebRTC）
  - 管理者がセッションに参加・監視・必要なら録画
  - 通報・BAN・課金（クレジット制）

**「安全第一の言語プラットフォーム」**として設計していく。

---

## 現状できていること（MVPレベル）

### 技術スタック

- Python / Django
- SQLite（開発環境）
- シンプルなテンプレート＋CSS（Tailwindっぽい雰囲気だけ自作）

### モデル（`core/models.py`）

- `LessonLanguage`  
  - 対応言語（例：English, Spanish, Japanese）
- `StudentProfile`  
  - Django `User` を拡張した「生徒プロフィール」
- `TutorProfile`  
  - Django `User` を拡張した「講師プロフィール」
  - 対応言語（ManyToMany）
  - `is_online`（オンライン待機フラグ）
  - `can_interview`（講師面接の担当ができるか）
  - `is_approved`（承認済み講師かどうか）※実装済みにする予定
- `QuickLessonRequest`
  - 生徒が「5分レッスンしたい」ときのリクエスト
  - `student`, `language`, `status`（waiting / matched / cancelled）
  - `purpose`（lesson / interview）※面接用にも使えるように
- `QuickLessonMatch`
  - 実際に誰と誰がマッチしたか
  - `request`, `tutor`
  - `started_at`, `end_at`（5分枠）
  - `price`（将来の課金用）
  - `room_id`（将来の WebRTC 用ルームID）
  - `meeting_provider`（"webrtc" / "external" など切替想定）

※ WebRTC自体はまだ「枠」の段階。中身はこれから。

---

## 今の画面フロー（MVP）

### 生徒側

1. ログイン
2. `/request/` で言語を選んで「5分レッスン開始」
3. バックエンドが：
   - `is_online=True` ＋ `is_approved=True` の講師を検索
   - 対応言語が一致する講師からランダムで1人選ぶ
4. マッチできた場合：
   - `QuickLessonMatch` 作成
   - `request_detail` 画面で講師情報や「レッスンルームへ」ボタンを表示
5. マッチできない場合：
   - `status=waiting` のまま
   - 「マッチング中…」の画面＋スピナー
   - 数秒ごとに自動リロードして、講師がオンラインになったらマッチング

### 講師側

1. ログイン
2. `/tutor/dashboard/` にアクセス
3. 条件を満たすユーザー（roleが`tutor` or `admin` ＋ `TutorProfile.is_approved=True`）だけここに入れるようにする予定
4. ダッシュボードでは：
   - 自分のステータスを「オンライン／オフライン」に切り替え
   - 最近担当したレッスン（マッチ）の一覧を確認

### 管理者（現状）

- Django Admin で：
  - 言語を登録
  - ユーザーを作成
  - `StudentProfile` / `TutorProfile` を紐づけ
  - 将来的には：
    - `UserProfile` の `role`（student / tutor / admin）
    - `TutorProfile.is_approved` を設定する運用にする

---

## これからやりたいこと（構想メモ）

### 1. 生徒 ↔ 講師 only を完全に徹底

- `UserProfile` を導入して `role` を管理：
  - `student` / `tutor` / `admin`
- マッチングロジック：
  - 生徒 (`role=student`) → 承認済み講師（`role=tutor` ＋ `is_approved=True`）だけ
  - 生徒 ↔ 生徒、講師 ↔ 講師などはシステム上作れない
- `/request/` は `role=student` のユーザーしか叩けないようにする
- `/tutor/dashboard/` は `role=tutor` or `role=admin` のみ

これだけでも、「出会い目的で複数アカウント作って遊ぶ」のはかなり面倒になる。

---

### 2. 本気の5分制限（時間コントロール）

- `QuickLessonMatch` の `started_at` / `end_at` をちゃんと使う
- `/lesson/room/<match_id>/` で：
  - 残り時間（秒）をサーバー側で計算してテンプレートに渡す
  - JSでカウントダウン表示
  - 0になったら：
    - WebRTC接続を閉じる（将来）
    - レッスン終了画面に自動遷移
- WebSocket（シグナリング）側でも、サーバーが「このマッチはすでに終了」と判断したら、そのルームの接続メッセージを拒否する設計を目指す。

**目的：**  
どんなに粘っても **5分以上の通話は続けさせない**。

---

### 3. サイト内ビデオ通話（WebRTC）

やりたいこと：

- Zoomなどに飛ばさず、**サイト内で完結するビデオ通話**
- 各マッチごとに `room_id` を発行
- `/lesson/room/<match_id>/` で：
  - ロール：生徒 / 講師 / 管理者
  - ロールに応じたUI（録画ボタンや警告など）
- 技術的には：
  - `getUserMedia` でカメラ・マイク
  - `RTCPeerConnection` で P2P
  - Django Channels or 別のシグナリングサーバーで WebSocket を使って offer/answer/ICE を交換

これは一番重いところなので、**段階的に進める予定**。  
今は「ルーム画面 + 自分のカメラ表示 + タイマー」までを先に固める。

---

### 4. 管理者による監視・録画

- 管理者はどのレッスンにも「監視者」として入室できる
  - `LessonParticipant` モデルで `role=admin` を持たせるイメージ
- 管理者だけ見えるUI（想定）：
  - 「録画開始 / 停止」ボタン
  - 「このユーザーを通報／一時停止」ボタン
- 録画は：
  - ブラウザ側 `MediaRecorder` を使って録画
  - 終了後に Django 側にアップロード
  - `Recording` モデルで `match` に紐づけて保存
- 利用規約で「違反行為の監視・証拠保全のために録画する場合がある」と明記する想定。

---

### 5. 通報・BAN・モデレーション

- レッスン後、またはレッスン中でもよいので「通報ボタン」を用意
- `Report` モデル：
  - `reported_user`
  - `reported_by`
  - `match`
  - `reason`（性的な発言、暴言、差別、出会い目的、など）
  - `comment`
- 一定数の通報で：
  - 自動的にアカウント一時停止
  - 管理者レビュー後にBAN or 復帰
- `UserProfile` に：
  - `is_banned` フラグを持たせ、ログイン時やマッチング時にチェック

---

### 6. 課金・クレジット制（出会い目的の冷やかし対策）

「無料でいくらでも5分通話できる」と、変な目的の人も混ざりやすいので：

- 生徒側にクレジット（ポイント）制を導入したい
  - 例：1レッスン = 1クレジット
  - Stripeなどでクレジット購入
- クレジットがないと `QuickLessonRequest` を作れないようにする
- あくまで **「本気で学習したい人だけが使う」雰囲気** に寄せたい

---

## このリポジトリの位置づけ

- 自分用の学習・ポートフォリオ・設計実験用
- とりあえずモノを動かしながら：
  - Djangoの実務寄りスキル
  - WebRTCまわりの知識
  - セキュリティ・モデレーション設計
- を鍛えていく感じ。

**最終イメージ：**

> 「5分だけ、安全に、サクッと外国語を話せる場所。  
>  出会い目的は最初から設計で潰してある。」

ここまで来れたら理想。

---
